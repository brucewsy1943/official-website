<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.official.dao.WebsiteContentMapper">
  <resultMap id="BaseResultMap" type="com.official.bean.WebsiteContent">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jan 25 14:30:38 CST 2019.
    -->
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="article_Id" jdbcType="INTEGER" property="articleId" />
    <result column="columnId" jdbcType="INTEGER" property="columnid" />
    <result column="ip" jdbcType="VARCHAR" property="ip" />
    <result column="visitCount" jdbcType="INTEGER" property="visitcount" />
    <result column="visitDate" jdbcType="TIMESTAMP" property="visitdate" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    delete from t_website_content
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.official.bean.WebsiteContent">
    insert into t_website_content (article_Id, columnId, 
      ip, visitCount, visitDate
      )
    values (#{articleId,jdbcType=INTEGER}, #{columnid,jdbcType=INTEGER}, 
      #{ip,jdbcType=VARCHAR}, #{visitcount,jdbcType=INTEGER}, #{visitdate,jdbcType=TIMESTAMP}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.official.bean.WebsiteContent">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jan 25 14:30:38 CST 2019.
    -->
    update t_website_content
    set article_Id = #{articleId,jdbcType=INTEGER},
      columnId = #{columnid,jdbcType=INTEGER},
      ip = #{ip,jdbcType=VARCHAR},
      visitCount = #{visitcount,jdbcType=INTEGER},
      visitDate = #{visitdate,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    select id, article_Id, columnId, ip, visitCount, visitDate
    from t_website_content
    where id = #{id,jdbcType=INTEGER}
  </select>
  
  <select id="selectAll" resultMap="BaseResultMap">
    select id, article_Id, columnId, ip, visitCount, visitDate
    from t_website_content
  </select>
  
  
    <select id="contentAnalysis" resultType="com.official.bean.dto.WebsiteContentDto">
   select a.title,COUNT(visitCount)as visit,FORMAT((COUNT(visitCount)/(SELECT COUNT(visitCount) from t_website_content))*100,2) as visitPercent, COUNT(DISTINCT ip)as ipCount,
     FORMAT((COUNT(DISTINCT ip)/(select COUNT(DISTINCT ip) from t_website_content))*100,2) as ipPercent
     from t_website_content wc
     LEFT JOIN t_article a on a.id=wc.article_Id
       <where>
             a.id is not null
             <if test='startDate==""  and endDate=="" '>
                     and   1=1
             </if>
             
             <if test='startDate!=""  and endDate=="" '>
                  and    wc.visitDate BETWEEN #{startDate} and DATE_ADD(now(),INTERVAL 1 DAY)
              </if>
              
              <if test='startDate==""  and endDate!="" '>
                   and  wc.visitDate BETWEEN '1999-01-01' and DATE_ADD(#{endDate},INTERVAL 1 DAY)
              </if>
              
              
              <if test='startDate!=""  and endDate!="" '>
                  and     wc.visitDate BETWEEN #{startDate} and DATE_ADD(#{endDate},INTERVAL 1 DAY)
              </if>     
             </where>
    GROUP BY wc.article_Id
    ORDER BY visit desc,wc.visitDate desc
    LIMIT 0,10
   </select>
  
  
  <select id="columnAnalysis" resultType="com.official.bean.dto.WebsiteContentDto">
  select c.columnName,COUNT(visitCount)as visit,FORMAT((COUNT(visitCount)/(SELECT COUNT(visitCount) from t_website_content))*100,2) as visitPercent, COUNT(DISTINCT ip)as ipCount,
 FORMAT((COUNT(DISTINCT ip)/(select COUNT(DISTINCT ip) from t_website_content))*100,2) as ipPercent
 from t_website_content wc
 LEFT JOIN t_column c on c.id=wc.columnId
  <where>
             
             <if test='startDate==""  and endDate=="" '>
                        1=1
             </if>
             
             <if test='startDate!=""  and endDate=="" '>
                      wc.visitDate BETWEEN #{startDate} and DATE_ADD(now(),INTERVAL 1 DAY)
              </if>
              
              <if test='startDate==""  and endDate!="" '>
                     wc.visitDate BETWEEN '1999-01-01' and DATE_ADD(#{endDate},INTERVAL 1 DAY)
              </if>
              
              
              <if test='startDate!=""  and endDate!="" '>
                       wc.visitDate BETWEEN #{startDate} and DATE_ADD(#{endDate},INTERVAL 1 DAY)
              </if>     
             </where>
 GROUP BY wc.columnId
 ORDER BY visit desc,wc.visitDate desc
 LIMIT 0,10
   </select>
  
  
  
</mapper>